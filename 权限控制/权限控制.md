# å‰ç«¯æƒé™æ§åˆ¶æ€è·¯

## èœå•ï¼ˆä¾§è¾¹æ ä¹‹ç±»ï¼‰çš„æ§åˆ¶ï¼ˆè·¯ç”±ï¼‰

ç™»å½•è¯·æ±‚ä¸­ï¼Œä¼šå¾—åˆ°æƒé™æ•°æ®ï¼Œè¿™ä¸ªæ•°æ®éœ€è¦åç«¯è¿”å›  æ ¹æ®è¿”å›çš„æ•°æ®åŠ¨æ€å±•ç¤ºæœ‰å“ªäº›èœå•

## ç•Œé¢çš„æ§åˆ¶

æœªç™»å½•ï¼Œæ‰‹åŠ¨æ•²ç®¡ç†ç•Œé¢åœ°å€  è·³è½¬åˆ°ç™»å½•é¡µé¢

å·²ç™»å½•ï¼Œæ•²å…¥éæƒé™å†…åœ°å€ï¼Œè½¬404é¡µé¢

## æŒ‰é’®çš„æ§åˆ¶

æŸä¸ªèœå•çš„é¡µé¢ä¸­ï¼Œè¿˜å¾—æ ¹æ®æƒé™æ•°æ®å±•ç¤ºæ“ä½œæŒ‰é’®ï¼Œæ¯”å¦‚å¢åˆ æ”¹æŸ¥

## è¯·æ±‚å’Œç›¸åº”çš„æ§åˆ¶

æœ‰äº›è¯·æ±‚æ— æƒé™å°±ä¸éœ€è¦å‘é€

```javascript
umiuä¸­ ç”¨plugin-accesså’Œ

æ§åˆ¶èœå•å’Œè·¯ç”±æ˜¾ç¤º`Authorized` è¿›è¡Œåˆ¤æ–­å¤„ç†ã€‚
```

https://jishuin.proginn.com/p/763bfbd5fbae

https://segmentfault.com/a/1190000039959870

> å‰ç«¯é¢è¯•https://juejin.cn/post/6881481205657632781#heading-11

æ‰¾ä¸€ç§å¥½çš„é‰´æƒæ–¹å¼
<!-- more -->
<!-- toc -->

# reacté‰´æƒ

æƒ³æ‰¾ä¸€ç§å¥½çš„é‰´æƒæ–¹å¼
å…ˆè°·æ­Œæœæ‰€æœ‰çš„é‰´æƒæ–¹æ³•å†æ¯”è¾ƒ

## Userfont

https://css-tricks.com/react-authentication-access-control/
å…ˆè¯´æœåŠ¡ç«¯çš„é‰´æƒæ€è·¯
ç„¶åè¯´Uerfontæ€ä¹ˆåœ¨å‰ç«¯é…åˆå¥½é‰´æƒ


## RBAC

https://tarunnagpal78.medium.com/tutorial-how-to-create-rbac-role-based-access-control-in-reactjs-87cb9a960cf3
æ–‡ç« ç®€å• ä»£ç ä¸å¯¹åº” æœ‰äº›ä¹±

ä¸»è¦ä»‹ç»rbacçš„æ¦‚å¿µ

## æˆ‘çš„æ¯•ä¸šè®¾è®¡é‡Œé‰´æƒçš„åº”ç”¨

çœ‹ä»£ç å’Œè¿è¡Œ


## Managing Access Control in a react ui

https://levelup.gitconnected.com/access-control-in-a-react-ui-71f1df60f354
[ä»“åº“ä»£ç ](https://github.com/duhseekoh/demo-access-control-in-react)



- å››å¹´å‰çš„æ–‡ç« ï¼Œæ¯”è¾ƒè¯¦ç»† ä»£ç ä¹Ÿæ˜¯å¯¹åº”çš„ï¼Œå¯èƒ½æœ‰äº›è€ï¼Œè€Œä¸”ä»£ç æ˜¯React Nativeçš„è·‘ä¸èµ·æ¥ï¼Œ
- è¿˜å¥½æ‰¾åˆ°äº†å¦å¤–codesandboxæ˜¯reactçš„ï¼Œ[é“¾æ¥](https://codesandbox.io/s/react-redux-rbac-converted-from-rn-rj328?file=/src/AccessControl.js)
- ä¸Šè¿°reactçš„ä»£ç æœ‰ç‚¹è€ï¼Œæˆ‘æ”¹è¿›å¯è¿è¡Œçš„ä»“åº“ï¼Œ[é“¾æ¥](https://github.com/Ekko306/react-redux-rbac)

Managing Access Control in a React App
åœ¨Reactåº”ç”¨é‡Œå¤„ç†æƒé™ç®¡ç†


æƒ³è±¡ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªReact.jsåº”ç”¨ã€‚æƒ³è±¡åº”ç”¨çš„ç›®çš„æ˜¯ç®¡ç†ä¸€ä¸ªåŸå­æ ¸ååº”å™¨ã€‚ç°åœ¨â€¦â€¦æƒ³è±¡ä¸€ä¸‹è¿™ä¸ªåº”ç”¨ç¨‹åºåªå­˜åœ¨è¿™æ ·æˆ‘å°±å¯ä»¥å†™ä¸€ç¯‡å…³äºåœ¨ React ä¸­å®ç°è®¿é—®æ§åˆ¶çš„ Medium æ–‡ç« ã€‚å¾ˆå¥½ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ï¼ˆæç¤ºï¼šè¿™ç¯‡æ–‡ç« æ‰€æœ‰ä¾‹å­éƒ½æ˜¯åŸºäºReact Native ä½†æ˜¯å¯ä»¥å¾ˆæ–¹ä¾¿ç”¨åˆ°web Reactï¼‰

![img1](https://miro.medium.com/max/1400/0*NznbEzq8NNWeNy3K)
ç”¨äºæ ¸ç”µç«™æ§åˆ¶åº”ç”¨ç¨‹åºçš„çº¿æ¡†å’Œåº”ç”¨ç¨‹åº UI

ä»€ä¹ˆå†³å®šäº†ç”¨æˆ·åœ¨åº”ç”¨é‡Œå¯ä»¥çœ‹è§ä»€ä¹ˆï¼ˆæƒé™ï¼‰ï¼Ÿ
æˆ‘çŸ¥é“æˆ‘ä»…ä»…æƒ³è¦ä¸€äº›ç”¨æˆ·æ¥æ§åˆ¶ååº”å™¨ï¼Œ
å…¶ä»–ç”¨æˆ·åªèƒ½è¯»å–ååº”å™¨å½“å‰çš„çŠ¶æ€ï¼Œ
å…¶ä»–å¾ˆå°‘çš„ç”¨æˆ·å¯ä»¥æ¿€æ´»ä¸€ä¸ªç´§æ€¥èƒ½é‡ä¾›åº”ï¼Œ
è¿˜æœ‰ä¸€äº›åªèƒ½æ¯å°æ—¶è¯»å–å®‰å…¨æ£€æŸ¥ï¼Œ
è¿˜æœ‰ä¸€äº›å¯ä»¥åœ¨å‘ç”µå‚å†…éƒ¨å‘å‡ºè­¦æŠ¥çš„ç”¨æˆ·ç­‰ã€‚
å¾ˆæ˜æ˜¾æˆ‘å¯¹åŸå­ååº”å †äº†è§£å¾ˆå¤šã€‚

### åŸºç¡€â€”â€”Reactçš„æ¡ä»¶æƒ…å†µ

åœ¨æˆ‘ä»¬è°ˆè®ºæ§åˆ¶ä¸€ä¸ªåŸå­ååº”å †å‰ï¼Œæˆ‘ä»¬è¦äº†è§£å¦‚ä½•åœ¨Reactå¾—åˆ°ä¸€äº›åŸºæœ¬é€»è¾‘ï¼Ÿ

åœ¨Reactä¸­å®šä¹‰UIçš„å£°æ˜æ€§è®©æ·»åŠ æ¡ä»¶æ˜¾ç¤ºé€»è¾‘å˜å¾—ç®€å•æ˜äº†ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶æ§åˆ¶é¡µé¢çš„å±•ç¤ºå’Œæ¶ˆå¤±ï¼ŒReactå¾ˆå®¹æ˜“ã€‚

```jsx
// Conditionally display a LoginScreen if there's no user  
const App = ({ user }) => (  
<View>  
{!user && <LoginScreen />}  
{user && <WelcomeScreen user={user} />}  
</View>  
);
```

å¦‚æœæˆ‘ä»¬\<App\>æœ‰ä¸€ä¸ªç”¨æˆ·é€šè¿‡ï¼Œç„¶åæˆ‘ä»¬ä¼šå±•ç¤ºWelcomeScreenï¼Œå…¶ä»–æƒ…å†µå±•ç¤ºLoginScreenã€‚è¿™ä¸ªæ˜¯æƒé™æ§åˆ¶æœ€ç®€å•çš„åŸºç¡€ï¼Œä¸€ä¸ªç®€å•çš„æ§åˆ¶ã€‚

æˆ‘ä»¬å¦‚ä½•å›´ç»•è¿™ä¸ªæ„å»ºä¸€ä¸ªæ¨¡å¼ï¼Ÿæˆ‘ä»¬ä¸ä»…éœ€è¦çŸ¥é“ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œè¿˜éœ€è¦å®æ—¶ç¡®å®šç”¨æˆ·åœ¨åº”ç”¨ç¨‹åºæœ‰å“ªäº›ç‰¹å®šçš„åŠŸèƒ½ã€‚

### ç»†åŒ–â€”â€”åŸºäºæƒé™çš„è®¿é—®æ§åˆ¶

ç»´åŸºç™¾ç§‘æœ‰ä¸€ç¯‡å¾ˆå¥½çš„æ–‡ç« å…³äº â€˜[Role-based access control](https://en.wikipedia.org/wiki/Role-based_access_control)â€™

> åœ¨ä¸€ä¸ªç»„ç»‡é‡Œï¼Œè§’è‰²ä»ä¸åŒçš„å·¥ä½œå‡½æ•°åˆ›å»ºã€‚æ‰§è¡ŒæŸäº›æ“ä½œçš„æƒé™åˆ†é…ç»™ç‰¹å®šè§’è‰²ã€‚æˆå‘˜æˆ–èŒå‘˜ï¼ˆæˆ–å…¶ä»–ç³»ç»Ÿç”¨æˆ·ï¼‰ä¼šè¢«åˆ†é…ç‰¹å®šè§’è‰²ï¼Œç„¶åé€šè¿‡é‚£äº›è§’è‰²åˆ†é…åˆ†é…ä¸€äº›ç³»ç»ŸåŠŸèƒ½çš„ç‰¹å®šæƒé™ã€‚

åœ¨å‰ç«¯ï¼Œæˆ‘ä»¬ä¸ç”¨å¤ªå¤šè§’è‰²rolesï¼Œåªç”¨è€ƒè™‘è§’è‰²å¯¹åº”çš„ä¸€äº›æƒé™ã€‚

å¦‚æœä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªå”®å–ç³»ç»Ÿï¼Œä½ å¯èƒ½ç»™å•†å®¶æƒé™å»ç”¨æŠ˜æ‰£é‡å†™ç‰¹å®šå•†å“çš„ä»·æ ¼ï¼Œè€Œå…¶ä»–çš„åº—å‘˜æ²¡æœ‰è¿™ä¸ªæƒé™ã€‚ä½ å¯èƒ½ç”šè‡³åœ¨UIä¾‹éšè—æ“ä½œç‰¹æ€§ç»™é‚£äº›ä¸èƒ½æ“ä½œçš„äººï¼Œè¿™å¯ä»¥é€šè¿‡ä¸ºæ¯ä¸ªç”¨æˆ·åˆ†é…ä¸€ç»„æƒé™æ¥å®ç°ã€‚

å¯¹äºæ ¸ç”µç«™æ§åˆ¶åº”ç”¨å‘¢ï¼Ÿè®©æˆ‘ä»¬æƒ³ä¸€äº›å¯ä»¥åˆ†é…ç»™ç¨‹åºç”¨æˆ·çš„æƒé™ï¼Œä¸ºäº†ç®€å•ï¼Œæ˜¯ä¸€ä¸ªæœ‰é™çš„é›†åˆï¼Œæ¯ä¸€ä¸ªæƒé™å¯¹åº”äºä¸€ä¸ªUIé¢æ¿ã€‚ï¼ˆå°±æ˜¯ç‰¹å®šäººå‘˜æ˜¾ç¤ºç‰¹å®šçš„æŒ‰é’®ï¼‰

![img2](https://miro.medium.com/max/418/1*dHGxDyEELs83oGZWNrt8gg.png)

ç„¶åè¿™äº›ç”¨æˆ·æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ

```jsx
User: Plant Manager
Permissions: read:stats, control:emergencyalert, control:reactor

User: Safety Inspector
Permissions: read:stats
```

Plant Mangerå¯ä»¥åšä»»ä½•äº‹æƒ…ï¼Œç„¶è€ŒSafety Inspectoråªèƒ½çœ‹ä¸‹ååº”å †çš„çš„çŠ¶æ€ã€‚

æˆ‘ä»¬æœ‰æˆ‘ä»¬çš„UIå¸ƒå±€å®šä¹‰ï¼Œä¸€äº›ç”¨æˆ·ï¼Œä¸€äº›æƒé™ï¼Œç„¶åæ€ä¹ˆè®©è¿™äº›æƒé™åœ¨UIä¾‹èƒ½å¤Ÿè·å–åˆ°ï¼Ÿ

### ç¼–ç ä¸ºReactç»„ä»¶

ç°åœ¨UIçš„å…³ç³»ï¼Œæƒé™å’Œç”¨æˆ·å®šä¹‰äº†,ä¸€ä¸ªReactç»„ä»¶å¯ä»¥è¢«æ„å»ºæ¥å®ç°ä¸Šè¿°å…³ç³»

å®ƒå°†ä¼šæä¾›ä¸€ä¸ªè‰¯å¥½å®šä¹‰çš„æ¥å£æ¥ç®¡ç†ä¸€äº›å˜é‡ç”¨æ¥å†³å®šç»„ä»¶çš„è§†å›¾ï¼Œå†³å®šæ˜¯å¦å±•ç¤ºè¢«ä¿æŠ¤çš„è§†å›¾ã€‚

å±æ€§ï¼š

- `children`â€”å¦‚æœç”¨æˆ·æœ‰æƒé™ï¼Œé‚£ä¹ˆè¿™ä¸ª"è¢«ä¿æŠ¤çš„ç»„ä»¶"ä¼šè¢«å±•ç¤º
- `userPermissions`â€”åˆ†é…ç»™ç™»å½•ç”¨æˆ·çš„æƒé™
- `allowedPermissions`â€”æƒé™åˆ—è¡¨ï¼Œå¦‚æœç™»å½•ç”¨æˆ·æ‹¥æœ‰å…¶ä¸­ä¹‹ä¸€ï¼Œé‚£ä¹ˆä»–ä»¬å¯ä»¥çœ‹åˆ°`children`
- `renderNoAccess`â€”å½“ç”¨æˆ·æ— æƒè®¿é—®å—ä¿æŠ¤ç»„ä»¶æ—¶è¿è¡Œ/æ˜¾ç¤ºçš„æ¸²æŸ“é“å…·

è¿™ç§ç»„ä»¶çš„åå­—ï¼š`<AccessControl>`

é€»è¾‘å›¾ï¼š
![img3](https://miro.medium.com/max/1232/0*4JlEvljl_xK89J9M)


ä½¿ç”¨ä¾‹å­ï¼š

```jsx
<AccessControl
  userPermissions={userPermissions}
  allowedPermissions={["read:stats"]}
  renderNoAccess={() => <NoAccess permissionsNeeded="read:stats" />}
>
  <StatsPanel />
</AccessControl>
```

è¿™é‡Œ`AccessControl`ç»„ä»¶åŒ…è£¹äº†ä¸€ä¸ª`StatsPanel`ç»„ä»¶ï¼Œåœ¨è¿™ç§ç‰¹å®šæƒ…å†µä¸‹ï¼Œç”¨æˆ·æœ‰ä¸€ä¸ªæƒé™`readLstats`å¹¶ä¸”`allowedPermissions`çš„ä¸€ä¸ªå†…å®¹æ˜¯`read:stats`ï¼Œé‚£ä¹ˆç”¨æˆ·å°±èƒ½çœ‹è§StatsPanelç»„ä»¶

ç»„ä»¶å®ç°æ–¹æ³•ï¼š

```jsx
// v1 AccessControl.js...const AccessControl = ({  
  userPermissions,  
  allowedPermissions,  
  children,  
  renderNoAccess,  
}) => {  
  // checkPermissions function verifies that one of the userPermissions is in the set of allowedPermissions  
  const permitted = checkPermissions(userPermissions, allowedPermissions);  
  
  if (permitted) {  
    return children;  
  }  
  return renderNoAccess();
};
```

### æ„å»ºæ ¸ååº”å †App

`AccessControl`ç»„ä»¶æ„å»ºå¥½äº†ï¼Œè®©æˆ‘ä»¬æ¥ä½¿ç”¨æ¥æ„å»ºååº”appã€‚

è¿™é‡Œæ˜¯ç®€å•çš„UIï¼ŒåŠ¨å›¾çš„å½¢å¼
![imgGif](https://miro.medium.com/max/774/1*BRnhOYwk_cChehWdJF_yBQ.gif)

ä»£ç å®ç°ï¼Œæœ‰å¤šä¸ªAccessControl

```jsx
...
<ScrollView style={styles.container}>
  ...
  <UserDetails user={loggedInUser} />
  <AccessControl
    userPermissions={userPermissions}
    allowedPermissions={["read:stats"]}
    renderNoAccess={() => <NoAccess permissionsNeeded="read:stats" />}
  >
    <StatsPanel />
  </AccessControl>
  <AccessControl
    userPermissions={userPermissions}
    allowedPermissions={["control:emergencyalert"]}
    renderNoAccess={() => (
      <NoAccess permissionsNeeded="control:emergencyalert" />
    )}
  >
    <EmergencyAlertPanel />
  </AccessControl>
  <AccessControl
    userPermissions={userPermissions}
    allowedPermissions={["control:reactor"]}
    renderNoAccess={() => (
      <NoAccess permissionsNeeded="control:reactor" />
    )}
  >
    <ShutdownPanel />
  </AccessControl>
</ScrollView>
...
```

ä¸Šé¢å±•ç¤ºçš„æ˜¯ä¸‰ä¸ªAccessControl ç»„ä»¶çš„ç”¨æ³•ï¼Œä»–ä»¬æ¯ä¸ªéƒ½æœ‰è‡ªå·±ä¿æŠ¤çš„ç»„ä»¶å’Œæƒé™æ¥æ§åˆ¶è·å–åˆ°è¢«ä¿æŠ¤çš„ç»„ä»¶ã€‚å‡è®¾ userPermissions æ˜¯ä¸€ä¸ªä½œä¸º prop å‡ºç°çš„æ•°ç»„ï¼Œç”±æ‚¨å­˜å‚¨ç™»å½•ç”¨æˆ·ä¿¡æ¯çš„ä»»ä½•ä½ç½®æä¾›ã€‚


### ä¸€ä¸ªæ›´ç®€æ´çš„æ¥å£â€”â€”é€šè¿‡Redux

(ä¸Šé¢è¯´userPermissionæ˜¯ä¸€ä¸ªå­˜å‚¨çš„ä¿¡æ¯çš„åœ°æ–¹ï¼Œè¿™é‡Œå¯ç”¨reduxå­˜å‚¨)

ä»»ä½•ä¸ç”±æƒé™æ§åˆ¶çš„åº”ç”¨å†…æ¡ä»¶ UI ç›¸å…³çš„åº”ç”¨éƒ½å·²ç»è¶³å¤Ÿå¤æ‚ï¼Œä»¥è‡³äºè¿™äº›æ¡ä»¶è®¿é—®æ§åˆ¶æƒ…å†µä¼šç»å¸¸å‡ºç°ã€‚æ‰€ä»¥ä½ å¯èƒ½åœ¨ä¸€ä¸ªé¡µé¢æœ‰æˆåƒä¸Šä¸‡ä¸ªAccessControlç»„ä»¶ï¼Œä¸æ–­åœ°åœ¨å½“å‰èŒƒå›´å†…æä¾›ç”¨æˆ·çš„æƒé™å¹¶å°†å®ƒä»¬ä½œä¸ºé“å…·ä¼ é€’ç»™ AccessControl çš„æ¯ä¸ªå®ä¾‹ä¼šå˜å¾—å¾ˆä¹å‘³ã€‚ç›¸åï¼Œè®©æˆ‘ä»¬å°† AccessControl è¿æ¥åˆ° Reduxï¼Œå®ƒå§‹ç»ˆå¯ä»¥è®¿é—®ç”¨æˆ·çš„æƒé™ã€‚

æ›´æ–°çš„åŸç†å›¾ï¼š
![img5](https://miro.medium.com/max/1232/0*l5_Qs2QQldfSuEl4)

å®ç°ä»£ç ï¼š

```jsx
const AccessControl = ({
  userPermissions,
  allowedPermissions,
  children,
  renderNoAccess,
}) => {
  const permitted = checkPermissions(userPermissions, allowedPermissions);
if (permitted) {
    return children;
  }
  return renderNoAccess();
};
...
// Compose AccessControl component with redux
export default connect(state => ({
  userPermissions: state.auth.user && state.auth.user.permissions,
}))(AccessControl);
```

é€šè¿‡connectingï¼ˆè¿æ¥ï¼‰AccessControlåˆ°reduxï¼Œè¿™ä¸ªç»„ä»¶è‡ªåŠ¨æœ‰`userPermissions`å±æ€§åº”ç”¨åˆ°ä¸Šé¢ï¼Œæ— è®ºç»„ä»¶åœ¨ä»€ä¹ˆåœ°æ–¹ï¼ˆä¸ç”¨ä¼ é€’userPermissionsï¼‰


```jsx
**_// ----------------------------------------------  
// without redux  
// ----------------------------------------------_**<AccessControl  
   ** userPermissions={userPermissions}**  
    allowedPermissions={["read:stats"]}  
    renderNoAccess={() => <NoAccess permissionsNeeded="read:stats" />}  
  >  
    <StatsPanel />  
  </AccessControl>**_// ----------------------------------------------  
// with redux - no need to supply userPermissions  
// ----------------------------------------------_**<AccessControl  
  allowedPermissions={["read:stats"]}  
  renderNoAccess={() => <NoAccess permissionsNeeded="read:stats" />}  
>  
  <StatsPanel />  
</AccessControl>
```

[ä¾‹å­é“¾æ¥](https://github.com/duhseekoh/demo-access-control-in-react/blob/master/example-apps/v2-access-control-redux/ExampleApp.js)

æ³¨æ„ï¼šRedux å¯ä»¥æ›¿æ¢ä¸ºæ‚¨ä½¿ç”¨çš„ä»»ä½•çŠ¶æ€ç®¡ç†è§£å†³æ–¹æ¡ˆï¼ˆMobXã€Apolloã€Realmã€localstorage ç­‰â€¦â€¦ï¼‰æ³¨æ„ï¼šRedux å¯ä»¥æ›¿æ¢ä¸ºæ‚¨ä½¿ç”¨çš„ä»»ä½•çŠ¶æ€ç®¡ç†è§£å†³æ–¹æ¡ˆï¼ˆMobXã€Apolloã€Realmã€localstorage ç­‰â€¦â€¦ï¼‰

### ä¸æ˜¯æ‰€æœ‰ä¸œè¥¿å¯ä»¥ç”¨æƒé™Permissionsè§£å†³

ï¼ˆç®€å•æ¥è¯´å°±æ˜¯å¯èƒ½æ™®é€šç®¡ç†å‘˜æœ‰å¾ˆå¤šnormal userï¼Œä½†æ˜¯useræœ‰ä¸åŒå›½å®¶çš„ï¼Œå¯¹äºä¸åŒå›½å®¶çš„normal user è¿˜å¯ä»¥å¢åŠ é¢å¤–çš„æƒé™ï¼Œæ›´åŠ ç»†åˆ†çµæ´»ï¼‰

æœ‰ä¸€äº›æƒ…å†µä¾‹å¦‚é™æ€çš„æƒé™ä¸èƒ½æä¾›è¶³å¼“çš„ä¿¡æ¯åˆ¤æ–­ä¸€ä¸ªç”¨æˆ·èƒ½å¦åšä¸€äº›äº‹æƒ…ã€‚å…³äºè¯¥ç”¨æˆ·æˆ–å…¶ä¸æŸä¸ªå…¶ä»–å®ä½“çš„å…³ç³»çš„å…¶ä»–å˜é‡å¯èƒ½æœ€ç»ˆç¡®å®šè¯¥ç”¨æˆ·æ˜¯å¦å…·æœ‰è®¸å¯ã€‚

è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªæ›´å¤æ‚çš„ä¾‹å­ã€‚ åŸæ¥æˆ‘ä»¬çš„ç”µå‚åº”ç”¨ç¨‹åºç°åœ¨æ˜¯ä¸€ä¸ª SaaS äº§å“ï¼Œæ¥è‡ªä¸–ç•Œå„åœ°çš„è¿è¥å•†å¯ä»¥ç™»å½•å¹¶æ§åˆ¶ä»–ä»¬è‡ªå·±çš„ç”µå‚ã€‚æˆ‘ä»¬ä¸å¸Œæœ›æœé²œçš„ç”µå‚ç»ç†æ§åˆ¶ç¾å›½çš„ç”µå‚ï¼Œå³ä½¿ä»–ä»¬æ‹¥æœ‰ä½¿ç”¨è¿™ä¸ªå…¨çƒå¯ç”¨çš„ SaaS äº§å“çš„å¿…è¦æƒé™ã€‚ è¿™ä¸ªæ›´å…·ä½“çš„é™åˆ¶å¯ä»¥é€šè¿‡å‘æˆ‘ä»¬çš„ç»„ä»¶æ·»åŠ ä¸€ä¸ªæ›´å¤šçš„ prop æ¥å®ç°ï¼Œè¿™ä¸ªå‡½æ•°ä¸­çš„è®¿é—®é€»è¾‘å¤ªå¤æ‚è€Œæ— æ³•ä»…å‡­æƒé™æ¥å¤„ç†ï¼Œå¯ä»¥è¢«çƒ˜ç„™åˆ°å…¶ä¸­ã€‚

å°±æ˜¯é¢å¤–å¢åŠ ä¸€äº›propï¼ˆä¸‰ä¸ªå­—æ®µï¼‰ï¼Œæ¥åˆ¤æ–­é¢å¤–çš„æƒé™ï¼Œä»£ç é‡Œæ˜¯ï¼Œå¤šåŠ å…¥userçš„å­—æ®µï¼Œçœ‹userçš„æƒé™ï¼š`accessCheck(extraAccessData, user) &&`

å®ç°ï¼š

```jsx
...
const AccessControl = ({
  user,
  userPermissions,
  allowedPermissions,
  children,
  renderNoAccess,
  accessCheck,
  extraAccessData,
}) => {
  let permitted;
  // when an accessCheck function is provided, ensure that passes as well as the permissions
  if (accessCheck) {
    permitted =
      accessCheck(extraAccessData, user) &&
      checkPermissions(userPermissions, allowedPermissions);
  } else {
    // otherwise only check permissions
    permitted = checkPermissions(userPermissions, allowedPermissions);
  }
  if (permitted) {
    return children;
  }
  return renderNoAccess();
};
...
export default connect(state => ({
  userPermissions: state.auth.user && state.auth.user.permissions,
  user: state.auth.user,
}))(AccessControl);
```

æ–°å¢ä¸‰ä¸ªå­—æ®µï¼š

- accessCheckâ€”â€”ä¸€ä¸ªå‡½æ•°æ‹¥æœ‰è‡ªå®šä¹‰å‡½æ•°ï¼Œå¦‚æœæä¾›äº†ï¼Œå¯¹äºæƒé™çš„çœ‹ä¿æŠ¤ç»„ä»¶çš„ç”¨æˆ·è¿”å›true
- extraAccessDataâ€”â€”ä¸€ç§ä½¿æ•°æ®å¯ç”¨äºè®¿é—® accessCheck æ–¹æ³•çš„ä¾¿æ·æ–¹æ³•ï¼Œè€Œæ— éœ€åœ¨å®šä¹‰ accessCheck æ–¹æ³•æ—¶â€œå…³é—­â€è¯¥æ•°æ®ï¼Œå°±æ˜¯è¾…åŠ©accessCheckçš„æ•°æ®
- userâ€”â€”é€šå¸¸ï¼Œè¿è¡Œè‡ªå®šä¹‰è®¿é—®æ£€æŸ¥æ‰€éœ€çš„å¿…è¦æ•°æ®å­˜å‚¨åœ¨ç”¨æˆ·èº«ä¸Šï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬å°†å­˜å‚¨åœ¨ redux ä¸­çš„ç”¨æˆ·æä¾›ç»™ AccessControl ç»„ä»¶ï¼Œå¹¶åœ¨è¿è¡Œæ—¶å°†å…¶ä¼ é€’ç»™ accessCheck å‡½æ•°ï¼ˆå°±æ˜¯state.auth.userï¼‰

ç„¶åä¸‹é¢çš„ä½¿ç”¨ä¾‹å­ï¼Œæ¥é˜»æ­¢æœé²œçš„æ“ä½œ

```jsx
<AccessControl
  extraAccessData={{ allowedNationality: "USA" }}
  accessCheck={(extraAccessData, user) =>
    user && user.nationality === extraAccessData.allowedNationality
  }
  renderNoAccess={() => (
    <View style={styles.countryWarning}>
      <Text style={styles.noAccessText}>
        Only Nuclear engineers from the USA ğŸ‡ºğŸ‡¸ can access this system.
      </Text>
    </View>
  )}
>
... // protected content
</AccessControl>
```


### å°±æ˜¯è¿™æ ·

è¿™ä¸æ˜¯å”¯ä¸€çš„æ–¹æ³•å†Reactå†™æƒé™æ§åˆ¶é€»è¾‘ï¼Œä½†æˆ‘å–œæ¬¢ï¼Œå› ä¸ºå®ƒå¯¹äºReactçš„å£°æ˜å¼åŸåˆ™å¾ˆç¬¦åˆã€‚å®ƒéµå¾ªä¹…ç»è€ƒéªŒçš„åŸºäºè§’è‰²/æƒé™çš„è®¿é—®æ§åˆ¶æ¨¡å‹ï¼Œæ‚¨çš„åç«¯ã€ç³»ç»Ÿå¯ä»¥å›´ç»•ç›¸åŒçš„è®¾ç½®æ„å»ºå…¶è®¿é—®é€»è¾‘ã€‚ä»è¿™ä¸ªåŸºæœ¬çš„ AccessControl å®šä¹‰å¼€å§‹ï¼Œå¯ä»¥å›´ç»•å®ƒæ„å»ºå¾ˆå¤šä¸œè¥¿ã€‚ æ·»åŠ  redux é›†æˆï¼Œåˆ›å»ºä¸€ä¸ªå°è£…é€»è¾‘çš„ HOCï¼Œåˆ›å»ºä¸€ä¸ªçƒ˜ç„™é™„åŠ é€»è¾‘çš„åŒ…è£…å™¨ç»„ä»¶ã€‚

### åœ¨æµè§ˆå™¨ä¸­è¿è¡Œä¸åŒç‰ˆæœ¬çš„åŸç”Ÿç”µå‚åº”ç”¨ç¨‹åºï¼ˆReact-Nativeï¼‰

[https://snack.expo.io/@git/github.com/duhseekoh/demo-access-control-in-react](https://snack.expo.io/@git/github.com/duhseekoh/demo-access-control-in-react)

### æˆ–è€…åœ¨GithubæŸ¥çœ‹ç›¸åŒçš„æºä»£ç 

[https://github.com/duhseekoh/demo-access-control-in-react](https://github.com/duhseekoh/demo-access-control-in-react)


### ä»£ç 

ä¾‹å­ä»£ç å’Œè½¬æ¢æˆReactçš„ä»£ç æœ‰bug

ä¸€ä¸ªæ˜¯åœ¨AccessControlé‡Œå†™å¥½connect
å¤–é¢é¡µé¢å°±ä¸éœ€è¦connectäº†ï¼ˆè¿™ä¸ªç»„ä»¶è‡ªåŠ¨è¿æ¥åˆ°storeè·å–å±æ€§ï¼‰


å¦ä¸€ä¸ªæ˜¯åœ¨æ¯ä¸ªç‰¹å®šçš„é¡µé¢ç»™å¤§ç»„ä»¶è¿æ¥storeè·å–å±æ€§
è¿™æ ·æ¯ä¸ªé¡µé¢å†™çš„åœ°æ–¹æ¯”è¾ƒå¤š


ä½†ç¬¬ä¸€ä¸ªæ–¹æ³•è€ƒè™‘æ•ˆç‡ï¼Ÿ æ¯ä¸ªç»„ä»¶è·å–storeä½†æ˜¯çœäº‹

æš‚æ—¶ç”¨ç¬¬ä¸€ç§ å…¶ä»–å†è¯´